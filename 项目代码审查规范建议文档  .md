# 📄 项目代码审查规范建议文档  
版本：v1.0  
适用范围：内部开发项目（包含AI辅助开发、非技术人员参与等）  
整理人：根据华君Kimi与孙立伟对话内容归纳  
整理时间：2025-08-06

---

## 🧱 一、项目结构规范

- ✅ 项目需采用**分层架构**（如 Controller / Service / Repository 或 MVC）；
- ✅ 模块命名清晰，具备一定的可读性和职责单一性；
- 🚫 禁止所有代码混杂在一个目录或文件中。

---

## 🔐 二、安全性设计规范

- ❗ **必须具备基本的安全防护意识**，包括但不限于：
  - 输入数据校验（防止SQL注入、XSS等）
  - 权限认证与访问控制（Token机制、RBAC等）
  - 对外接口需进行身份校验
  - 敏感操作应记录安全日志

- ✅ 推荐参考OWASP Top 10安全开发规范，建立最小权限原则。

---

## 🗃️ 三、数据库操作规范

- 🔄 **严谨处理数据库操作**，避免“能用就好”的临时性方案：
  - 应使用ORM或规范化SQL访问
  - 明确事务控制边界
  - 加入异常处理（try-catch）和失败回滚机制
  - 避免硬编码数据库连接参数，应配置化

- 🚫 禁止将数据库部署在开发人员本机作为长期运行环境。

---

## 📦 四、日志管理规范（重点）

### ✅ 日志通用化要求：
1. 日志模块应**抽象为工具类/中间件**，避免各模块各写各的；
2. 应区分日志级别：
   - `DEBUG`: 调试日志，开发阶段使用
   - `INFO`: 常规操作日志
   - `WARN`: 可恢复异常，如配置缺失
   - `ERROR`: 程序运行异常
   - `SECURITY`: 安全类事件，如登录失败、异常访问

3. 应统一输出格式（如 JSON 或统一模板），记录至少包括：
   - 时间戳
   - 操作类型
   - 操作人 / 请求来源
   - 异常堆栈（如有）

4. 系统应在入口层统一捕获异常，集中记录，防止异常丢失。

---

## 🚀 五、缓存和静态变量优化建议

- ✅ 对于频繁使用但不变的数据（配置、枚举、静态文件路径等），应使用静态常量或懒加载；
- ✅ 对重复耗时计算/IO操作结果，建议使用内存缓存（如Map、LRU缓存等）；
- ✅ 使用缓存时应考虑过期策略、并发安全、缓存穿透问题。

---

## 🧠 六、AI辅助生成代码的审查要点

- AI生成代码只能作为**初稿**或“思路辅助”，不应直接用于生产；
- 应由开发人员进行：
  - 安全审查
  - 逻辑完整性验证
  - 风险评估（边界条件、异常处理等）

---

## 💬 七、语言和协作规范

- ✅ 团队协作项目需提前确认开发语言（如 Java / C# / Python）；
- ✅ 避免团队成员不熟悉的语言导致维护困难；
- ✅ 若使用TypeScript等新语言，需搭配注释和文档说明关键部分。

---

## 💡 八、意识与态度：从“能跑”到“优雅”

- 代码质量不以“能跑”为唯一标准，还应考虑：
  - 可维护性（是否易读易改）
  - 可扩展性（是否易于新增功能）
  - 可测试性（是否支持自动化测试）
  - 可部署性（是否具备配置、日志、安全、性能等）

- 开发者应树立“工程意识”，把代码当作**作品**来写，而非一次性交付品。

---

## 📌 附录：建议保存在团队内部知识库的代码规则（rules）举例

| 规则编号 | 规则描述 | 建议等级 |
|----------|-----------|-----------|
| R001 | 日志模块必须封装，禁止散乱打印 | 高 |
| R002 | 所有数据库操作必须带异常处理 | 高 |
| R003 | 敏感操作必须记录安全日志 | 高 |
| R004 | 项目需支持日志分级输出 | 高 |
| R005 | 可缓存的数据应做缓存（避免重复计算） | 中 |
| R006 | 所有请求应有异常捕获与统一返回机制 | 高 |
| R007 | AI生成代码须经人工评审、安全审查 | 高 |
| R008 | 统一使用团队确认的开发语言 | 中 |
