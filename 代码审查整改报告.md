# ğŸ” åŸ¹è®­ç³»ç»Ÿä»£ç å®¡æŸ¥æ•´æ”¹æŠ¥å‘Š

**ç‰ˆæœ¬**: v1.0  
**å®¡æŸ¥æ—¶é—´**: 2025-01-13  
**å®¡æŸ¥èŒƒå›´**: training-system-backendã€training-system-frontend  
**å®¡æŸ¥ä¾æ®**: [é¡¹ç›®ä»£ç å®¡æŸ¥è§„èŒƒå»ºè®®æ–‡æ¡£.md](../é¡¹ç›®ä»£ç å®¡æŸ¥è§„èŒƒå»ºè®®æ–‡æ¡£.md)

---

## ğŸ“‹ å®¡æŸ¥æ€»ç»“

æœ¬æ¬¡å®¡æŸ¥å‘ç°äº†**ä¸¥é‡çš„ä»£ç è´¨é‡å’Œå®‰å…¨é—®é¢˜**ï¼Œä¸»è¦é›†ä¸­åœ¨æ—¥å¿—ç®¡ç†ã€ç¡¬ç¼–ç é…ç½®ã€å¼‚å¸¸å¤„ç†ã€å®‰å…¨é˜²æŠ¤ç­‰æ–¹é¢ã€‚é¡¹ç›®ç›®å‰å¤„äº"èƒ½è·‘"çŠ¶æ€ï¼Œä½†è·ç¦»ç”Ÿäº§çº§åˆ«çš„ä»£ç è´¨é‡è¿˜æœ‰å¾ˆå¤§å·®è·ã€‚

### ğŸš¨ ä¸¥é‡é—®é¢˜ç»Ÿè®¡
- **é«˜ä¼˜å…ˆçº§é—®é¢˜**: 12é¡¹
- **ä¸­ä¼˜å…ˆçº§é—®é¢˜**: 8é¡¹
- **ä½ä¼˜å…ˆçº§é—®é¢˜**: 6é¡¹

---

## ğŸ¯ é«˜ä¼˜å…ˆçº§é—®é¢˜ (å¿…é¡»ç«‹å³æ•´æ”¹)

### 1. æ—¥å¿—ç®¡ç†è§„èŒƒä¸¥é‡ç¼ºå¤± âŒ R001
**é—®é¢˜æè¿°**: 
- å¤§é‡ä½¿ç”¨ `console.log` è¿›è¡Œè°ƒè¯•è¾“å‡ºï¼Œç¼ºä¹ç»Ÿä¸€çš„æ—¥å¿—ç®¡ç†æœºåˆ¶
- æ— æ—¥å¿—çº§åˆ«åˆ’åˆ†ï¼Œæ— å®‰å…¨æ—¥å¿—è®°å½•
- ç”Ÿäº§ç¯å¢ƒä¸­è°ƒè¯•æ—¥å¿—ä¼šæš´éœ²æ•æ„Ÿä¿¡æ¯

**å½±å“æ–‡ä»¶**:
```
training-system-backend/src/modules/project-management/services/project-mentorship.service.ts:28,133,666,676
training-system-backend/src/shared/infrastructure/database/prisma.service.ts:13,15,19,21,39
training-system-frontend/src/utils/request.ts:51,60,93
training-system-frontend/src/stores/personalCenter.ts:258,260
```

**æ•´æ”¹å»ºè®®**:
1. åˆ›å»ºç»Ÿä¸€çš„æ—¥å¿—æœåŠ¡ç±» (`LoggerService`)
2. å®ç°æ—¥å¿—çº§åˆ«ç®¡ç† (DEBUG/INFO/WARN/ERROR/SECURITY)
3. æ•æ„Ÿæ“ä½œå¿…é¡»è®°å½•å®‰å…¨æ—¥å¿—
4. ç”Ÿäº§ç¯å¢ƒç¦ç”¨è°ƒè¯•æ—¥å¿—è¾“å‡º

### 2. ç¡¬ç¼–ç é…ç½®é—®é¢˜ âŒ R002
**é—®é¢˜æè¿°**: 
- æ•°æ®åº“å¯†ç ã€JWTå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ç¡¬ç¼–ç 
- ç«¯å£å·ã€URLç­‰é…ç½®åˆ†æ•£åœ¨ä»£ç ä¸­
- ç¼ºä¹ç¯å¢ƒå˜é‡ç»Ÿä¸€ç®¡ç†

**å½±å“æ–‡ä»¶**:
```
training-system-backend/config/development.env:8,16 (ç¡¬ç¼–ç å¯†ç )
training-system-backend/README.md:42 (JWTå¯†é’¥ç¡¬ç¼–ç )
training-system-frontend/src/utils/request.ts:18,33,40-43 (URLå’Œæµ‹è¯•æ•°æ®ç¡¬ç¼–ç )
```

**æ•´æ”¹å»ºè®®**:
1. æ‰€æœ‰æ•æ„Ÿé…ç½®è¿ç§»åˆ°ç¯å¢ƒå˜é‡
2. åˆ›å»ºé…ç½®ç®¡ç†æœåŠ¡
3. ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®æ–‡ä»¶
4. ç§»é™¤ä»£ç ä¸­çš„ç¡¬ç¼–ç å€¼

### 3. æ•°æ®åº“æ“ä½œå¼‚å¸¸å¤„ç†ä¸å®Œå–„ âŒ R002
**é—®é¢˜æè¿°**: 
- éƒ¨åˆ†æ•°æ®åº“æ“ä½œç¼ºä¹try-catchåŒ…è£…
- å¼‚å¸¸ä¿¡æ¯ç›´æ¥æš´éœ²ç»™å‰ç«¯
- ç¼ºä¹äº‹åŠ¡æ§åˆ¶å’Œå›æ»šæœºåˆ¶

**å½±å“æ–‡ä»¶**:
```
training-system-backend/src/shared/infrastructure/database/prisma.service.ts:36-41 (cleanDatabaseæ–¹æ³•)
training-system-backend/src/modules/project-management/services/project-mentorship.service.ts:669-680
```

**æ•´æ”¹å»ºè®®**:
1. æ‰€æœ‰æ•°æ®åº“æ“ä½œå¿…é¡»åŒ…è£…åœ¨try-catchä¸­
2. æ•æ„Ÿé”™è¯¯ä¿¡æ¯ä¸å¾—è¿”å›ç»™å‰ç«¯
3. é‡è¦æ“ä½œéœ€è¦äº‹åŠ¡æ§åˆ¶
4. å»ºç«‹æ•°æ®åº“æ“ä½œå®¡è®¡æ—¥å¿—

### 4. èº«ä»½è®¤è¯å®‰å…¨æ¼æ´ âŒ R003
**é—®é¢˜æè¿°**: 
- å‰ç«¯è¯·æ±‚æ‹¦æˆªå™¨ä¸­ä¸´æ—¶å…³é—­äº†è®¤è¯æœºåˆ¶
- ä½¿ç”¨ç¡¬ç¼–ç çš„æµ‹è¯•token
- è§’è‰²æƒé™éªŒè¯å­˜åœ¨ç»•è¿‡é£é™©

**å½±å“æ–‡ä»¶**:
```
training-system-frontend/src/utils/request.ts:46-49 (è®¤è¯è¢«æ³¨é‡Š)
training-system-frontend/src/utils/request.ts:33-44 (ç¡¬ç¼–ç æµ‹è¯•èº«ä»½)
training-system-backend/src/shared/auth/guards/roles.guard.ts:32-35 (å¼€å‘æ¨¡å¼ç»•è¿‡è®¤è¯)
```

**æ•´æ”¹å»ºè®®**:
1. æ¢å¤ç”Ÿäº§ç¯å¢ƒçš„è®¤è¯æœºåˆ¶
2. ç§»é™¤æ‰€æœ‰ç¡¬ç¼–ç çš„æµ‹è¯•å‡­æ®
3. å¼ºåŒ–è§’è‰²æƒé™éªŒè¯é€»è¾‘
4. æ·»åŠ å®‰å…¨å®¡è®¡æ—¥å¿—

### 5. XSSå®‰å…¨æ¼æ´ âŒ å®‰å…¨æ€§è§„èŒƒ
**é—®é¢˜æè¿°**: 
- ä½¿ç”¨ `dangerouslyUseHTMLString` ç›´æ¥æ¸²æŸ“HTMLå†…å®¹
- ç¼ºä¹è¾“å…¥æ•°æ®çš„XSSè¿‡æ»¤
- ç”¨æˆ·è¾“å…¥æœªè¿›è¡Œå……åˆ†éªŒè¯

**å½±å“æ–‡ä»¶**:
```
training-system-frontend/src/modules/workbench/components/mentorship/SubsidyManagement.vue:1204
```

**æ•´æ”¹å»ºè®®**:
1. ç¦æ­¢ä½¿ç”¨ `dangerouslyUseHTMLString`
2. æ‰€æœ‰ç”¨æˆ·è¾“å…¥å¿…é¡»è¿›è¡ŒXSSè¿‡æ»¤
3. ä½¿ç”¨å®‰å…¨çš„HTMLæ¸²æŸ“æ–¹å¼
4. å»ºç«‹è¾“å…¥éªŒè¯ç™½åå•æœºåˆ¶

### 6. æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™© âŒ R003
**é—®é¢˜æè¿°**: 
- é”™è¯¯ä¿¡æ¯åŒ…å«æ•æ„ŸæŠ€æœ¯ç»†èŠ‚
- è°ƒè¯•æ—¥å¿—å¯èƒ½æš´éœ²ä¸šåŠ¡é€»è¾‘
- ç¼ºä¹æ•æ„Ÿæ•°æ®è„±æ•å¤„ç†

**å½±å“æ–‡ä»¶**:
```
training-system-backend/src/modules/project-management/services/project-mentorship.service.ts:676-678
training-system-frontend/src/modules/project-management/pages/ProjectDetail.vue:905-909
```

**æ•´æ”¹å»ºè®®**:
1. é”™è¯¯ä¿¡æ¯æ ‡å‡†åŒ–ï¼Œé¿å…æš´éœ²æŠ€æœ¯ç»†èŠ‚
2. ç”Ÿäº§ç¯å¢ƒç§»é™¤æ‰€æœ‰è°ƒè¯•ä¿¡æ¯
3. æ•æ„Ÿæ•°æ®ä¼ è¾“å‰è¿›è¡Œè„±æ•
4. å»ºç«‹ä¿¡æ¯å®‰å…¨å®¡æŸ¥æœºåˆ¶

---

## âš ï¸ ä¸­ä¼˜å…ˆçº§é—®é¢˜ (å»ºè®®ä¼˜åŒ–)

### 7. ç¼“å­˜æœºåˆ¶ç¼ºå¤± R005
**é—®é¢˜æè¿°**: 
- é¢‘ç¹é‡å¤çš„APIè°ƒç”¨ç¼ºä¹ç¼“å­˜
- é™æ€é…ç½®æ•°æ®æœªåšç¼“å­˜ä¼˜åŒ–
- å¤§é‡é‡å¤è®¡ç®—æœªä¼˜åŒ–

**å½±å“æ–‡ä»¶**:
```
training-system-frontend/src/stores/budget.ts (æ— ç¼“å­˜ç­–ç•¥)
training-system-frontend/src/stores/activities.ts (è®¡ç®—å±æ€§å¯ä¼˜åŒ–)
```

**æ•´æ”¹å»ºè®®**:
1. å®ç°APIå“åº”ç¼“å­˜æœºåˆ¶
2. é™æ€æ•°æ®ä½¿ç”¨LRUç¼“å­˜
3. è®¡ç®—ç»“æœç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—

### 8. é”™è¯¯å¤„ç†æœºåˆ¶ä¸ç»Ÿä¸€
**é—®é¢˜æè¿°**: 
- å‰åç«¯é”™è¯¯å¤„ç†æ–¹å¼ä¸ä¸€è‡´
- ç¼ºä¹ç»Ÿä¸€çš„é”™è¯¯ç ä½“ç³»
- ç”¨æˆ·ä½“éªŒä¸å‹å¥½çš„é”™è¯¯æç¤º

**æ•´æ”¹å»ºè®®**:
1. å»ºç«‹ç»Ÿä¸€é”™è¯¯ç ä½“ç³»
2. ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
3. ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤ºæ–‡æ¡ˆ

### 9. APIè®¾è®¡ä¸è§„èŒƒ
**é—®é¢˜æè¿°**: 
- ç¼ºä¹ç»Ÿä¸€çš„APIå“åº”æ ¼å¼
- APIç‰ˆæœ¬ç®¡ç†ç¼ºå¤±
- æ¥å£æ–‡æ¡£ä¸å®Œæ•´

**æ•´æ”¹å»ºè®®**:
1. ç»Ÿä¸€APIå“åº”æ ¼å¼æ ‡å‡†
2. å®æ–½APIç‰ˆæœ¬æ§åˆ¶
3. å®Œå–„æ¥å£æ–‡æ¡£å’Œç±»å‹å®šä¹‰

---

## ğŸ’¡ ä½ä¼˜å…ˆçº§é—®é¢˜ (å»ºè®®æ”¹è¿›)

### 10. ä»£ç ç»„ç»‡ç»“æ„å¾…ä¼˜åŒ–
**é—®é¢˜æè¿°**: 
- éƒ¨åˆ†æ–‡ä»¶è¿‡å¤§ï¼ŒèŒè´£ä¸å¤Ÿå•ä¸€
- å·¥å…·å‡½æ•°åˆ†æ•£ï¼Œç¼ºä¹ç»Ÿä¸€ç®¡ç†

**æ•´æ”¹å»ºè®®**:
1. æ‹†åˆ†å¤§æ–‡ä»¶ï¼Œéµå¾ªå•ä¸€èŒè´£åŸåˆ™
2. å»ºç«‹å…¬å…±å·¥å…·åº“
3. ä¼˜åŒ–æ¨¡å—é—´ä¾èµ–å…³ç³»

### 11. TypeScriptç±»å‹å®šä¹‰ä¸å®Œå–„
**é—®é¢˜æè¿°**: 
- éƒ¨åˆ†å˜é‡ä½¿ç”¨`any`ç±»å‹
- æ¥å£ç±»å‹å®šä¹‰ä¸å¤Ÿä¸¥æ ¼

**æ•´æ”¹å»ºè®®**:
1. å®Œå–„TypeScriptç±»å‹å®šä¹‰
2. å‡å°‘`any`ç±»å‹çš„ä½¿ç”¨
3. å¯ç”¨ä¸¥æ ¼æ¨¡å¼æ£€æŸ¥

---

## ğŸ› ï¸ æ•´æ”¹ä¼˜å…ˆçº§å’Œæ—¶é—´å®‰æ’

### ç¬¬ä¸€é˜¶æ®µ (ç´§æ€¥ï¼Œ1-2å¤©)
- [ ] ä¿®å¤æ—¥å¿—ç®¡ç†é—®é¢˜
- [ ] è§£å†³ç¡¬ç¼–ç é…ç½®
- [ ] ä¿®å¤è®¤è¯å®‰å…¨æ¼æ´
- [ ] å¤„ç†XSSå®‰å…¨é£é™©

### ç¬¬äºŒé˜¶æ®µ (é‡è¦ï¼Œ3-5å¤©)  
- [ ] å®Œå–„æ•°æ®åº“å¼‚å¸¸å¤„ç†
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
- [ ] å®æ–½ç¼“å­˜ä¼˜åŒ–
- [ ] è§„èŒƒAPIè®¾è®¡

### ç¬¬ä¸‰é˜¶æ®µ (æ”¹è¿›ï¼Œ1å‘¨)
- [ ] ä¼˜åŒ–ä»£ç ç»“æ„
- [ ] å®Œå–„ç±»å‹å®šä¹‰
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„

---

## ğŸ“Š è§„èŒƒéµå¾ªåº¦è¯„ä¼°

| è§„èŒƒé¡¹ç›® | éµå¾ªåº¦ | è¯„çº§ | å¤‡æ³¨ |
|---------|--------|------|------|
| R001 æ—¥å¿—ç®¡ç† | 20% | âŒ å·® | ç¼ºä¹ç»Ÿä¸€æ—¥å¿—æœºåˆ¶ |
| R002 æ•°æ®åº“æ“ä½œ | 60% | âš ï¸ ä¸­ç­‰ | éƒ¨åˆ†ç¼ºä¹å¼‚å¸¸å¤„ç† |
| R003 å®‰å…¨é˜²æŠ¤ | 30% | âŒ å·® | è®¤è¯æœºåˆ¶å­˜åœ¨æ¼æ´ |
| R004 é¡¹ç›®ç»“æ„ | 70% | âœ… è‰¯å¥½ | åŸºæœ¬éµå¾ªåˆ†å±‚æ¶æ„ |
| R005 ç¼“å­˜ä¼˜åŒ– | 40% | âš ï¸ ä¸­ç­‰ | ç¼ºä¹ç¼“å­˜ç­–ç•¥ |
| R006 å¼‚å¸¸å¤„ç† | 50% | âš ï¸ ä¸­ç­‰ | ä¸å¤Ÿç»Ÿä¸€å®Œå–„ |
| R007 AIä»£ç å®¡æŸ¥ | 90% | âœ… ä¼˜ç§€ | AIä»£ç éœ€äººå·¥å®¡æŸ¥ |
| R008 å¼€å‘è¯­è¨€ç»Ÿä¸€ | 100% | âœ… ä¼˜ç§€ | TypeScript/NestJSç»Ÿä¸€ |

**æ€»ä½“è¯„åˆ†**: 52.5/100 (âš ï¸ éœ€è¦å¤§å¹…æ”¹è¿›)

---

## ğŸ”§ å…·ä½“æ•´æ”¹å®æ–½æ–¹æ¡ˆ

### 1. æ—¥å¿—æœåŠ¡å®ç°æ–¹æ¡ˆ
```typescript
// åç«¯æ—¥å¿—æœåŠ¡
@Injectable()
export class LoggerService {
  private logger = winston.createLogger({
    levels: { security: 0, error: 1, warn: 2, info: 3, debug: 4 },
    format: winston.format.combine(
      winston.format.timestamp(),
      winston.format.json()
    ),
    transports: [
      new winston.transports.File({ filename: 'security.log', level: 'security' }),
      new winston.transports.File({ filename: 'error.log', level: 'error' }),
      new winston.transports.File({ filename: 'combined.log' })
    ]
  });

  security(message: string, context?: any) {
    this.logger.log('security', message, { context, timestamp: new Date() });
  }
  
  error(message: string, trace?: string, context?: any) {
    this.logger.error(message, { trace, context, timestamp: new Date() });
  }
}
```

### 2. é…ç½®ç®¡ç†æœåŠ¡
```typescript
// é…ç½®æœåŠ¡
@Injectable()
export class ConfigurationService {
  private readonly config: AppConfig;
  
  constructor() {
    this.config = {
      database: {
        host: process.env.DB_HOST || 'localhost',
        port: parseInt(process.env.DB_PORT || '3306'),
        password: process.env.DB_PASSWORD,
      },
      jwt: {
        secret: process.env.JWT_SECRET,
        expiresIn: process.env.JWT_EXPIRES_IN || '7d',
      },
      security: {
        enableAuth: process.env.NODE_ENV !== 'development',
        corsOrigin: process.env.CORS_ORIGIN?.split(',') || ['http://localhost:5173'],
      }
    };
  }
}
```

### 3. ç»Ÿä¸€å¼‚å¸¸å¤„ç†
```typescript
// å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨
@Catch()
export class GlobalExceptionFilter implements ExceptionFilter {
  constructor(private readonly logger: LoggerService) {}

  catch(exception: unknown, host: ArgumentsHost): void {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse<Response>();
    const request = ctx.getRequest<Request>();

    // è®°å½•å®‰å…¨æ—¥å¿—
    this.logger.security('APIå¼‚å¸¸', {
      url: request.url,
      method: request.method,
      ip: request.ip,
      userAgent: request.get('User-Agent'),
      exception: exception instanceof Error ? exception.message : exception
    });

    // è¿”å›å®‰å…¨çš„é”™è¯¯ä¿¡æ¯
    const status = exception instanceof HttpException ? exception.getStatus() : 500;
    const message = status === 500 ? 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯' : exception instanceof Error ? exception.message : 'æœªçŸ¥é”™è¯¯';

    response.status(status).json({
      code: status,
      message,
      timestamp: new Date().toISOString(),
    });
  }
}
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### å®‰å…¨æ£€æŸ¥æ¸…å•
- [ ] æ‰€æœ‰ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯å·²è¿ç§»åˆ°ç¯å¢ƒå˜é‡
- [ ] è®¤è¯æœºåˆ¶åœ¨æ‰€æœ‰ç¯å¢ƒä¸‹æ­£å¸¸å·¥ä½œ
- [ ] XSSé˜²æŠ¤æªæ–½å·²å®æ–½
- [ ] é”™è¯¯ä¿¡æ¯ä¸åŒ…å«æ•æ„ŸæŠ€æœ¯ç»†èŠ‚
- [ ] æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡éªŒè¯å’Œè¿‡æ»¤

### ä»£ç è´¨é‡æ¸…å•  
- [ ] ç»Ÿä¸€çš„æ—¥å¿—ç®¡ç†ç³»ç»Ÿå·²å®æ–½
- [ ] æ‰€æœ‰æ•°æ®åº“æ“ä½œåŒ…å«å¼‚å¸¸å¤„ç†
- [ ] ç¼“å­˜æœºåˆ¶å·²å®ç°
- [ ] ä»£ç ç»“æ„éµå¾ªå•ä¸€èŒè´£åŸåˆ™
- [ ] TypeScriptç±»å‹å®šä¹‰å®Œå–„

### æ€§èƒ½æ£€æŸ¥æ¸…å•
- [ ] APIå“åº”æ—¶é—´ < 200ms (95%è¯·æ±‚)
- [ ] å‰ç«¯é¦–å±åŠ è½½æ—¶é—´ < 3s
- [ ] å†…å­˜ä½¿ç”¨ç¨³å®šï¼Œæ— å†…å­˜æ³„æ¼
- [ ] æ•°æ®åº“æŸ¥è¯¢å·²ä¼˜åŒ–

---

## ğŸ“ è”ç³»ä¸è·Ÿè¿›


**ä¸‹æ¬¡å®¡æŸ¥**: æ•´æ”¹å®Œæˆåè¿›è¡ŒäºŒæ¬¡å®¡æŸ¥  

**æ³¨æ„äº‹é¡¹**:
1. é«˜ä¼˜å…ˆçº§é—®é¢˜å¿…é¡»åœ¨ç”Ÿäº§éƒ¨ç½²å‰å®Œæˆæ•´æ”¹
2. æ•´æ”¹è¿‡ç¨‹ä¸­å¦‚é‡æŠ€æœ¯éš¾é¢˜ï¼ŒåŠæ—¶æ²Ÿé€š
3. æ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œä»£ç Review
4. å»ºç«‹å®šæœŸä»£ç è´¨é‡æ£€æŸ¥æœºåˆ¶

---

*æœ¬æŠ¥å‘Šä¾æ®ã€Šé¡¹ç›®ä»£ç å®¡æŸ¥è§„èŒƒå»ºè®®æ–‡æ¡£ã€‹æ ‡å‡†åˆ¶ä½œï¼Œæ—¨åœ¨æå‡ä»£ç è´¨é‡å’Œç³»ç»Ÿå®‰å…¨æ€§ã€‚*
