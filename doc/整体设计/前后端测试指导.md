# 培训系统前后端测试指导

## 测试前准备

### 1. 环境要求
- Node.js 18+
- MySQL 8.0+
- Chrome/Edge 浏览器（推荐）

### 2. 数据库初始化
1. 创建数据库：
   ```sql
   CREATE DATABASE training_system DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

2. 运行初始化脚本：
   ```bash
   cd training-system-backend
   mysql -u root -p training_system < scripts/init-database-fixed.sql
   ```

### 3. 环境变量配置
创建 `training-system-backend/config/development.env` 文件：
```env
NODE_ENV=development
PORT=3000
DATABASE_URL="mysql://username:password@localhost:3306/training_system"
JWT_SECRET=your-jwt-secret-key
JWT_EXPIRES_IN=7d
```

## 后端启动测试

### 1. 安装依赖
```bash
cd training-system-backend
npm install
```

### 2. 启动后端服务
```bash
npm run start:dev
```

### 3. 验证后端启动
- 访问 `http://localhost:3000` 应该看到 "Training System API is running"
- 检查控制台无错误信息
- 数据库连接成功

## 前端启动测试

### 1. 安装依赖
```bash
cd training-system-frontend
npm install
```

### 2. 启动前端服务
```bash
npm run dev
```

### 3. 验证前端启动
- 访问 `http://localhost:5173` 应该看到登录页面
- 检查控制台无错误信息

## 功能测试流程

### 1. 用户注册测试
1. 访问 `http://localhost:5173`
2. 点击"没有账号？立即注册"
3. 填写表单：
   - 用户名：admin
   - 真实姓名：管理员
   - 邮箱：admin@example.com
   - 密码：123456
   - 确认密码：123456
4. 点击"注册"按钮
5. **预期结果**：注册成功，自动跳转到主页面

### 2. 用户登录测试
1. 访问 `http://localhost:5173`
2. 填写登录表单：
   - 用户名：admin
   - 密码：123456
3. 点击"登录"按钮
4. **预期结果**：登录成功，跳转到主页面

### 3. 项目管理测试
1. 登录后，点击侧边栏"项目管理"
2. 进入项目列表页面
3. **预期结果**：显示项目列表（可能为空）

### 4. 项目创建测试
1. 在项目列表页面，点击"创建项目"或类似按钮
2. 填写项目信息
3. 点击"保存项目"
4. **预期结果**：项目创建成功，出现成功提示

### 5. 预算管理测试
1. 进入项目详情页面
2. 点击"预算"标签
3. 添加预算项目
4. **预期结果**：预算数据保存成功

### 6. 资源管理测试
1. 进入项目详情页面
2. 点击"资源"标签
3. 添加资源项目
4. **预期结果**：资源数据保存成功

## 常见问题排查

### 1. 后端启动失败
- **问题**：数据库连接失败
- **解决**：检查数据库是否启动，用户名密码是否正确
- **问题**：端口被占用
- **解决**：更改端口或关闭占用程序

### 2. 前端启动失败
- **问题**：依赖安装失败
- **解决**：删除 node_modules 重新安装
- **问题**：代理配置错误
- **解决**：检查 vite.config.ts 中的代理配置

### 3. 登录失败
- **问题**：用户名或密码错误
- **解决**：检查数据库中的用户数据
- **问题**：JWT配置错误
- **解决**：检查环境变量中的JWT_SECRET

### 4. API调用失败
- **问题**：网络错误
- **解决**：检查后端是否正常运行
- **问题**：权限错误
- **解决**：检查token是否有效

### 5. 保存按钮没有反应（🚨 新增）
这是一个常见问题，可能的原因和解决方案：

#### 5.1 检查浏览器控制台
1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 点击保存按钮，查看是否有错误信息
4. 常见错误：
   - **401 Unauthorized**：权限验证失败
   - **404 Not Found**：API路径不存在
   - **500 Internal Server Error**：服务器内部错误

#### 5.2 检查Network标签
1. 打开开发者工具的 Network 标签
2. 点击保存按钮
3. 查看是否有API请求发出
4. 检查请求状态：
   - 🟢 **200**：成功
   - 🔴 **4xx**：客户端错误
   - 🔴 **5xx**：服务器错误

#### 5.3 验证后端API
使用以下命令测试后端API是否正常：

```bash
# 测试项目创建API
curl -X POST http://localhost:3000/api/projects \
  -H "Content-Type: application/json" \
  -d '{
    "title": "测试项目",
    "description": "测试描述",
    "startDate": "2024-01-01",
    "endDate": "2024-12-31",
    "managerId": "550e8400-e29b-41d4-a716-446655440001"
  }'

# 测试预算API（需要先有项目ID）
curl -X POST http://localhost:3000/api/projects/{项目ID}/budget-lines \
  -H "Content-Type: application/json" \
  -d '[{
    "category": "测试费用",
    "item": "测试项目",
    "budgetAmount": 10000
  }]'

# 测试资源API（需要先有项目ID）
curl -X POST http://localhost:3000/api/projects/{项目ID}/resources \
  -H "Content-Type: application/json" \
  -d '{
    "type": "DIGITAL",
    "name": "测试资源",
    "responsible": "测试负责人"
  }'
```

#### 5.4 检查数据库连接
```sql
-- 验证数据库表是否存在
SHOW TABLES;

-- 检查用户表
SELECT * FROM users LIMIT 5;

-- 检查项目表
SELECT * FROM training_projects LIMIT 5;
```

#### 5.5 重启服务
如果以上步骤都没有解决问题，尝试重启：

```bash
# 重启后端
cd training-system-backend
npm run start:dev

# 重启前端
cd training-system-frontend
npm run dev
```

#### 5.6 查看详细日志
在项目详情页面打开浏览器控制台，应该能看到详细的调试信息：
- 保存项目时会显示：`保存项目，项目ID: xxx`
- API调用成功时会显示成功消息
- API调用失败时会显示具体错误原因

## 调试技巧

### 1. 后端调试
- 查看控制台输出
- 检查数据库数据
- 使用 Postman 测试API

### 2. 前端调试
- 打开浏览器开发者工具
- 查看 Console 和 Network 标签
- 检查 localStorage 中的 token

### 3. 数据库调试
```sql
-- 查看用户表
SELECT * FROM users;

-- 查看项目表
SELECT * FROM projects;

-- 查看预算表
SELECT * FROM budget_lines;
```

## 测试数据

### 默认测试账号
- 用户名：admin
- 密码：123456
- 角色：管理员

### API测试端点
- 登录：POST `/api/auth/login`
- 注册：POST `/api/auth/register`
- 获取项目：GET `/api/project-management/projects`
- 创建项目：POST `/api/project-management/projects`
- 获取预算：GET `/api/project-management/budget?projectId=xxx`
- 获取资源：GET `/api/project-management/resource?projectId=xxx`

## 性能测试

### 1. 页面加载时间
- 首页加载应在 2 秒内完成
- 项目列表加载应在 3 秒内完成

### 2. API响应时间
- 认证接口应在 500ms 内响应
- 数据查询接口应在 1 秒内响应

## 测试报告

### 完成后请记录以下信息：
1. 测试环境（操作系统、浏览器版本）
2. 测试时间
3. 测试结果（成功/失败）
4. 遇到的问题及解决方案
5. 建议和改进意见

---

**注意**：如果在测试过程中遇到任何问题，请详细记录错误信息，包括：
- 错误发生的具体步骤
- 浏览器控制台的错误信息
- 服务器端的错误日志
- 数据库的相关数据状态 



用户名	密码	角色
admin	admin123456	管理员
teacher	teacher123456	教师
counselor	counselor123456	辅导员



## 🚀 快速启动指南

### 启动后端服务
```bash
cd training-system-backend
npm install
npm run start:dev
```

### 启动前端服务
```bash
cd training-system-frontend
npm install
npm run dev
```

### 访问系统
- **前端地址**: http://localhost:5173
- **后端地址**: http://localhost:3000
- **初始访问**: 会自动跳转到登录页面

### 测试账号
- **用户名**: admin
- **密码**: admin123456

### 详细测试指导
请参考：`doc/整体设计/前后端测试指导.md`