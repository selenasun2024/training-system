# 项目管理技术文档

## 1. 技术实现细节

### 1.1 菜单配置实现

#### 1.1.1 菜单类型定义
```typescript
// src/menu/types.ts
export interface MenuItem {
  title: string;          // 菜单标题
  icon?: string;          // 菜单图标
  path?: string;          // 路由路径
  children?: MenuItem[];  // 子菜单
  permission?: string;    // 权限标识
}
```

#### 1.1.2 项目管理模块菜单配置
```typescript
// src/menu/modules/project-management.ts
import { MenuItem } from '../types';

export const projectManagement: MenuItem = {
  title: '项目管理',
  icon: 'project',
  children: [
    {
      title: '项目列表',
      path: '/project/list',
      permission: 'project:list:view'
    },
    {
      title: '项目详情',
      path: '/project/detail',
      permission: 'project:detail:view'
    }
  ]
};
```

### 1.2 组件实现示例

#### 1.2.1 项目卡片组件
```vue
<!-- src/components/business/ProjectCard.vue -->
<template>
  <el-card class="project-card">
    <template #header>
      <div class="card-header">
        <h3>{{ project.title }}</h3>
        <el-tag>{{ project.status }}</el-tag>
      </div>
    </template>
    <div class="card-content">
      <div class="info-item">
        <span class="label">负责人：</span>
        <span>{{ project.manager }}</span>
      </div>
      <div class="info-item">
        <span class="label">开始时间：</span>
        <span>{{ formatDate(project.startTime) }}</span>
      </div>
      <div class="info-item">
        <span class="label">结束时间：</span>
        <span>{{ formatDate(project.endTime) }}</span>
      </div>
      <div class="progress-info">
        <span class="label">项目进度：</span>
        <el-progress :percentage="project.progress" />
      </div>
    </div>
    <div class="card-footer">
      <el-button type="primary" @click="handleView">查看详情</el-button>
      <el-button v-if="hasEditPermission" @click="handleEdit">编辑</el-button>
    </div>
  </el-card>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { formatDate } from '@/utils/date';

interface ProjectProps {
  project: {
    title: string;
    status: string;
    manager: string;
    startTime: string;
    endTime: string;
    progress: number;
  }
}

const props = defineProps<ProjectProps>();
const emit = defineEmits(['view', 'edit']);

const hasEditPermission = computed(() => {
  // 权限判断逻辑
  return true;
});

const handleView = () => {
  emit('view', props.project);
};

const handleEdit = () => {
  emit('edit', props.project);
};
</script>

<style scoped lang="scss">
.project-card {
  margin-bottom: 16px;
  
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    
    h3 {
      margin: 0;
    }
  }
  
  .card-content {
    .info-item {
      margin-bottom: 8px;
      
      .label {
        color: #666;
        margin-right: 8px;
      }
    }
    
    .progress-info {
      margin-top: 16px;
    }
  }
  
  .card-footer {
    margin-top: 16px;
    text-align: right;
  }
}
</style>
```

#### 1.2.2 项目列表页面
```vue
<!-- src/modules/project-management/pages/ProjectList.vue -->
<template>
  <div class="project-list">
    <filter-section>
      <el-form :inline="true" :model="filterForm">
        <el-form-item label="项目名称">
          <el-input v-model="filterForm.title" placeholder="请输入项目名称" />
        </el-form-item>
        <el-form-item label="项目状态">
          <el-select v-model="filterForm.status" placeholder="请选择状态">
            <el-option
              v-for="item in statusOptions"
              :key="item.value"
              :label="item.label"
              :value="item.value"
            />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">搜索</el-button>
          <el-button @click="handleReset">重置</el-button>
        </el-form-item>
      </el-form>
    </filter-section>

    <list-section>
      <div class="project-grid">
        <project-card
          v-for="project in projectList"
          :key="project.id"
          :project="project"
          @view="handleViewProject"
          @edit="handleEditProject"
        />
      </div>
      <div class="pagination">
        <el-pagination
          v-model:current-page="currentPage"
          v-model:page-size="pageSize"
          :total="total"
          :page-sizes="[10, 20, 50, 100]"
          layout="total, sizes, prev, pager, next"
          @size-change="handleSizeChange"
          @current-change="handleCurrentChange"
        />
      </div>
    </list-section>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import FilterSection from '@/components/sections/FilterSection.vue';
import ListSection from '@/components/sections/ListSection.vue';
import ProjectCard from '@/components/business/ProjectCard.vue';
import { useProjectStore } from '@/stores/project';

const router = useRouter();
const projectStore = useProjectStore();

const filterForm = ref({
  title: '',
  status: ''
});

const statusOptions = [
  { label: '未开始', value: 'not_started' },
  { label: '进行中', value: 'in_progress' },
  { label: '已完成', value: 'completed' }
];

const currentPage = ref(1);
const pageSize = ref(20);
const total = ref(0);

const projectList = ref([]);

const loadProjects = async () => {
  const { data, total: totalCount } = await projectStore.fetchProjects({
    page: currentPage.value,
    pageSize: pageSize.value,
    ...filterForm.value
  });
  projectList.value = data;
  total.value = totalCount;
};

const handleSearch = () => {
  currentPage.value = 1;
  loadProjects();
};

const handleReset = () => {
  filterForm.value = {
    title: '',
    status: ''
  };
  handleSearch();
};

const handleSizeChange = (val: number) => {
  pageSize.value = val;
  loadProjects();
};

const handleCurrentChange = (val: number) => {
  currentPage.value = val;
  loadProjects();
};

const handleViewProject = (project: any) => {
  router.push(`/project/detail/${project.id}`);
};

const handleEditProject = (project: any) => {
  router.push(`/project/edit/${project.id}`);
};

onMounted(() => {
  loadProjects();
});
</script>

<style scoped lang="scss">
.project-list {
  padding: 24px;

  .project-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 24px;
    margin-bottom: 24px;
  }

  .pagination {
    display: flex;
    justify-content: flex-end;
  }
}
</style>
```

### 1.3 状态管理实现

#### 1.3.1 项目管理Store
```typescript
// src/stores/project.ts
import { defineStore } from 'pinia';
import { fetchProjectList, fetchProjectDetail } from '@/api/project';

export const useProjectStore = defineStore('project', {
  state: () => ({
    projectList: [],
    currentProject: null,
    loading: false,
    error: null
  }),
  
  actions: {
    async fetchProjects(params) {
      this.loading = true;
      try {
        const response = await fetchProjectList(params);
        this.projectList = response.data;
        return response;
      } catch (err) {
        this.error = err.message;
        throw err;
      } finally {
        this.loading = false;
      }
    },
    
    async fetchProjectDetail(id) {
      this.loading = true;
      try {
        const response = await fetchProjectDetail(id);
        this.currentProject = response.data;
        return response.data;
      } catch (err) {
        this.error = err.message;
        throw err;
      } finally {
        this.loading = false;
      }
    }
  }
});
```

### 1.4 API接口定义

#### 1.4.1 项目管理接口
```typescript
// src/api/modules/project.ts
import request from '@/utils/request';

export interface ProjectQueryParams {
  page: number;
  pageSize: number;
  title?: string;
  status?: string;
}

export interface Project {
  id: string;
  title: string;
  status: string;
  manager: string;
  startTime: string;
  endTime: string;
  progress: number;
}

export function fetchProjectList(params: ProjectQueryParams) {
  return request({
    url: '/api/projects',
    method: 'get',
    params
  });
}

export function fetchProjectDetail(id: string) {
  return request({
    url: `/api/projects/${id}`,
    method: 'get'
  });
}

export function createProject(data: Partial<Project>) {
  return request({
    url: '/api/projects',
    method: 'post',
    data
  });
}

export function updateProject(id: string, data: Partial<Project>) {
  return request({
    url: `/api/projects/${id}`,
    method: 'put',
    data
  });
}

export function deleteProject(id: string) {
  return request({
    url: `/api/projects/${id}`,
    method: 'delete'
  });
}
```

## 2. 工具函数实现

### 2.1 日期格式化
```typescript
// src/utils/date.ts
export function formatDate(date: string | Date, format: string = 'YYYY-MM-DD'): string {
  const d = new Date(date);
  const year = d.getFullYear();
  const month = String(d.getMonth() + 1).padStart(2, '0');
  const day = String(d.getDate()).padStart(2, '0');
  
  return format
    .replace('YYYY', String(year))
    .replace('MM', month)
    .replace('DD', day);
}
```

### 2.2 HTTP请求封装
```typescript
// src/utils/request.ts
import axios from 'axios';
import type { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios';
import { ElMessage } from 'element-plus';

const service: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 15000
});

service.interceptors.request.use(
  (config) => {
    // 在请求发送前处理
    const token = localStorage.getItem('token');
    if (token) {
      config.headers['Authorization'] = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

service.interceptors.response.use(
  (response: AxiosResponse) => {
    const res = response.data;
    if (res.code !== 0) {
      ElMessage.error(res.message || '请求失败');
      return Promise.reject(new Error(res.message || '请求失败'));
    }
    return res;
  },
  (error) => {
    ElMessage.error(error.message || '请求失败');
    return Promise.reject(error);
  }
);

export default service;
```

## 3. 组件通信方案

### 3.1 项目状态更新事件总线
```typescript
// src/utils/eventBus.ts
import mitt from 'mitt';

type Events = {
  'project-updated': { id: string; data: any };
  'project-deleted': string;
};

export const eventBus = mitt<Events>();
```

## 4. 权限控制实现

### 4.1 权限指令
```typescript
// src/directives/permission.ts
import { DirectiveBinding } from 'vue';
import { useUserStore } from '@/stores/user';

export const permission = {
  mounted(el: HTMLElement, binding: DirectiveBinding) {
    const { value } = binding;
    const userStore = useUserStore();
    
    if (value && !userStore.hasPermission(value)) {
      el.parentNode?.removeChild(el);
    }
  }
};
```

## 5. 主题定制实现

### 5.1 Element Plus主题变量
```scss
// src/styles/element-variables.scss
@forward 'element-plus/theme-chalk/src/common/var.scss' with (
  $colors: (
    'primary': (
      'base': #1890ff,
    ),
    'success': (
      'base': #52c41a,
    ),
    'warning': (
      'base': #faad14,
    ),
    'danger': (
      'base': #ff4d4f,
    ),
    'info': (
      'base': #909399,
    ),
  )
);
``` 