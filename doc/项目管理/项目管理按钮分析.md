# 培训项目状态与按钮逻辑设计文档

---

## ✅ 一、项目状态逻辑梳理

| 状态            | 描述             | 可否编辑     | 可见按钮（建议）                                               |
|------------------|------------------|---------------|------------------------------------------------------------------|
| draft（草稿）    | 项目筹备中       | ✅ 可编辑     | 编辑相关功能（如任务配置、阶段设置）                           |
| active（已发布） | 项目正式执行中   | ❌ 不可编辑主要结构，但可做项目管理操作 | 考勤管理、协同管理、撤回项目、结束项目、保存项目模板（部分按钮可隐藏） |

---

## ✅ 二、“保存项目”按钮问题分析

### 现状：
- “保存项目”按钮的实际作用不明确。
- 当前系统各模块内容已自动保存，导致用户误解按钮功能。

### 当前保存按钮的实际功能（2024年7月）

#### 1. 前端数据整合与保存流程
- “保存项目”按钮会收集并整合多个子模块的数据，包括：
  - **基本信息**：项目名称、描述、类型、时间范围等
  - **议程数据**：完整的培训议程结构（如每日安排、课程、讲师等）
  - **分组数据**：学员分组信息（如小组划分、组员名单等）
  - **项目配置**：功能模块开关（群聊、全程规划、议程管理等）
- 这些数据通过统一的表单校验和数据整合，形成一个完整的项目数据对象。

#### 2. 后端API调用与数据持久化
- 新建项目时，调用`createProject` API，将所有整合数据一次性保存到数据库。
- 编辑项目时，调用`updateProject` API，更新数据库中的项目记录。
- 后端会：
  - 保存主项目信息到`trainingProject`表
  - 自动创建默认培训阶段
  - 同步分组数据到独立的Group表
  - 智能合并config配置，确保系统配置与前端配置兼容

#### 3. 业务意义与用户体验
- “保存项目”按钮的存在，确保了**多模块数据的一致性**和**批量保存**，避免了分散保存带来的数据不一致风险。
- 用户可以在编辑多个模块后，通过一次点击将所有更改同步到后端，提升了操作的确定性和安全感。
- 对于复杂项目，统一保存操作有助于项目负责人把控整体进度和数据完整性。

#### 4. 典型数据结构示例
```json
{
  "name": "项目名称",
  "description": "项目描述",
  "type": "项目类型ID",
  "startDate": "开始日期",
  "endDate": "结束日期",
  "config": {
    "type": "项目类型",
    "org": "组织部门",
    "owner": "项目负责人",
    "target": "培训对象",
    "location": "培训地点",
    "goal": "培训目标",
    "enableGroupChat": true,
    "enableFullPlan": true,
    "enableAgenda": true,
    "agenda": { "days": [...] },
    "groups": [...]
  }
}
```

### 建议处理：

#### 技术层建议：
- 检查是否仍存在以下行为：
  - 是否有收集多个表单统一提交？
  - 是否有调用 API 保存哪些字段？
- 如果只是视觉上的“总保存”，建议**取消此按钮**。
- **如当前实现，建议保留“保存项目”按钮，并优化其交互提示，明确其为“多模块数据整合与批量保存”操作。**

#### 产品体验建议：
- 按钮可能让用户误以为“必须点击才会保存”，违背即时保存设计。
- 若确有保存功能，可限制在特定配置页显示，**大多数场景下应隐藏或取消**。
- **如当前实现，建议在按钮旁增加“已整合全部模块数据，点击后统一保存”提示，提升用户信心。**

---

## ✅ 三、“发布项目”按钮逻辑梳理

### 功能：
- 将项目状态设为 `active`。
- 锁定所有项目信息（如阶段任务等不可再更改）。
- 启用管理功能入口（考勤管理、成绩管理等）。

### 建议：
- 发布前需弹窗确认，如：“发布后将无法修改项目信息，是否继续？”
- 发布后应自动隐藏“编辑项目”按钮，防止误操作。

---

## ✅ 四、“撤回项目”按钮逻辑建议

### 功能：
- 将项目状态从 `active` 恢复为 `draft`。
- 项目再次可编辑。

### 建议：
- **仅在已发布状态下显示**。
- 建议放在“...”菜单中以减少误操作。
- 点击后弹窗确认撤回行为，确保用户理解影响。

---

## ✅ 五、“结束项目”与“保存项目模板”按钮

### 功能：
- 结束项目：将项目标记为完成，供归档与复盘。
- 保存模板：将当前项目另存为模板供下次复用。
- 两个按钮具体功能，请见《项目管理功能设计.md》文件

### 建议：
- 使用频率较低，应默认隐藏。
- **仅在特定角色/权限或项目已发布状态下可见**。
- 建议置于“...”中，仅供项目负责人使用。

---

## ✅ 六、按钮行为与状态逻辑总览表

| 按钮名称         | 所属状态 | 当前作用/功能说明                                                                 | 使用时机               | 是否可见（默认） | 显示建议与说明                                                                 |
|------------------|----------|----------------------------------------------------------------------------------|------------------------|------------------|--------------------------------------------------------------------------------|
| 保存项目         | draft    | 整合多模块数据并统一保存到后端（包括基本信息、议程、分组、配置等）                 | 项目处于 draft 时      | ✅ 可见           | 保留，作为多模块数据整合与批量保存操作                                        |
| 发布项目         | draft    | 将项目状态设为 active，进入执行阶段，锁定主要内容                                  | 项目准备完成时         | ✅ 可见           | 保留，发布前弹窗提示“发布后无法修改”，发布后隐藏“编辑项目”按钮                |
| 撤回项目         | active   | 将项目状态从 active 撤回为 draft，恢复可编辑状态                                   | 项目已发布后           | ❌ 默认隐藏       | 保留，建议放在“...”菜单中，并增加二次确认提示                                  |
| 考勤管理         | active   | 进入考勤管理模块                                                                 | 项目已发布后           | ✅ 可见           | 保留，作为项目执行管理工具之一                                                 |
| 协同管理         | active   | 管理项目协作任务                                                                 | 项目已发布后           | ✅ 可见           | 保留，作为项目执行管理工具之一                                                 |
| 编辑项目         | active   | 修改项目内容（若未禁用）                                                         | 项目执行中（如允许修改） | ❌（应禁用）     | 若项目发布后不可修改，应隐藏或禁用此按钮                                       |
| 结束项目         | active   | 标记项目为已完成，进入归档或复盘流程                                              | 项目执行完毕时         | ❌ 默认隐藏       | 保留，仅项目负责人/特定权限可见，日常隐藏                                     |
| 保存项目模板     | active   | 将当前项目另存为模板，便于后续复用                                               | 项目已发布或结束后     | ❌ 默认隐藏       | 保留，仅项目负责人可见，放在“...”菜单中                                        |

---

## ✅ 七、总结与建议

| 按钮             | 建议                                                                 |
|------------------|----------------------------------------------------------------------|
| 保存项目         | 检查是否仍有功能，若已不需要，应移除                                 |
| 发布项目         | 保留，发布前提示不可更改，发布后切换状态为 active                    |
| 撤回项目         | 保留，发布后才能看到，建议放入"..."中并提示确认                      |
| 结束项目、保存模板 | 保留功能，默认隐藏，仅特定角色或状态下显示                           |

---

## ✅ 八、当前实现状态（2024年7月更新）

根据实际代码分析和需求，已完成以下按钮逻辑实现：

### DRAFT状态按钮：
- ✅ **保存项目**：整合多模块数据（基本信息、议程、分组、配置）并统一保存
- ✅ **发布项目**：发布前弹窗确认，发布后自动切换到管理功能界面

### ACTIVE状态按钮：
- ✅ **考勤管理**：跳转到考勤管理页面
- ✅ **协同管理**：跳转到协同管理页面  
- ✅ **作业管理**：跳转到作业管理页面
- ✅ **成绩管理**：跳转到成绩管理页面
- ✅ **更多操作**：下拉菜单包含"撤回项目"、"结束项目"、"保存为模板"

### 关键特性：
- 状态驱动的按钮显示逻辑
- 重要操作的二次确认机制
- 清晰的页面间导航
- 符合设计文档的用户体验

### 实现文件：
- `training-system-frontend/src/modules/project-management/pages/ProjectDetail.vue`
- 根据项目状态（DRAFT/ACTIVE）动态显示不同的按钮组合
- 包含完整的导航和操作处理逻辑
